<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ° ã‚¹ãƒ­ãƒƒãƒˆã‚²ãƒ¼ãƒ ç®¡ç†ç”»é¢</title>
    
    <!-- å‹•çš„ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ã®è¨­å®š -->
    <script>
        console.log("ç®¡ç†ç”»é¢èª­ã¿è¾¼ã¿é–‹å§‹");
        // ç¾åœ¨ã®URLã‹ã‚‰ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹ã‚’å‹•çš„ã«å–å¾—
        window.basePath = window.location.pathname.replace(/\/[^\/]*$/, '/');
        console.log("ãƒ™ãƒ¼ã‚¹ãƒ‘ã‚¹:", window.basePath);
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: #2c3e50;
            color: white;
            padding: 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }

        .content {
            padding: 20px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        h2 {
            color: #2c3e50;
            margin-bottom: 20px;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
        }

        .probability-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .probability-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
        }

        button {
            background: #3498db;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-top: 10px;
            transition: background 0.3s;
        }

        button:hover {
            background: #2980b9;
        }

        .alert {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th, td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }

        th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .code-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .tab-container {
            margin-top: 20px;
        }

        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ddd;
        }

        .tab-button {
            padding: 10px 20px;
            background: #f8f9fa;
            border: none;
            margin-right: 5px;
            cursor: pointer;
            border-radius: 5px 5px 0 0;
        }

        .tab-button.active {
            background: #3498db;
            color: white;
        }

        .tab-content {
            display: none;
            padding: 20px;
            background: white;
            border: 1px solid #ddd;
            border-top: none;
        }

        .tab-content.active {
            display: block;
        }

        .footer {
            text-align: center;
            margin-top: 20px;
            padding: 20px;
            color: #666;
        }

        .game-preview {
            border: 1px solid #ddd;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            background: #f8f9fa;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-primary {
            background: #3498db;
        }

        .btn-success {
            background: #2ecc71;
        }

        .btn-warning {
            background: #f39c12;
        }

        .btn-danger {
            background: #e74c3c;
        }

        @media (max-width: 768px) {
            .probability-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 1.8rem;
            }
            
            .section {
                padding: 15px;
            }
        }
    </style>
    
    <!-- game-manager.jsã®èª­ã¿è¾¼ã¿ -->
    <script src="./game-manager.js" defer></script>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ° ã‚¹ãƒ­ãƒƒãƒˆã‚²ãƒ¼ãƒ ç®¡ç†ç”»é¢</h1>
            <p>ç¢ºç‡è¨­å®šãƒ»çµ±è¨ˆç®¡ç†ãƒ»ã‚³ãƒ¼ãƒ‰å±¥æ­´</p>
        </div>

        <div class="content">
            <!-- ç¢ºç‡è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="section">
                <h2>âš™ï¸ ç¢ºç‡è¨­å®š</h2>
                <div id="probabilityAlert"></div>
                
                <div class="probability-grid">
                    <div class="probability-item">
                        <label for="jackpotProb">ã‚¸ãƒ£ãƒƒã‚¯ãƒãƒƒãƒˆç¢ºç‡ (%)</label>
                        <input type="number" id="jackpotProb" min="0" max="100" step="0.1">
                    </div>
                    
                    <div class="probability-item">
                        <label for="bigWinProb">ãƒ“ãƒƒã‚°ã‚¦ã‚£ãƒ³ç¢ºç‡ (%)</label>
                        <input type="number" id="bigWinProb" min="0" max="100" step="0.1">
                    </div>
                    
                    <div class="probability-item">
                        <label for="smallWinProb">ã‚¹ãƒ¢ãƒ¼ãƒ«ã‚¦ã‚£ãƒ³ç¢ºç‡ (%)</label>
                        <input type="number" id="smallWinProb" min="0" max="100" step="0.1">
                    </div>
                    
                    <div class="probability-item">
                        <label for="loseProb">è² ã‘ç¢ºç‡ (%)</label>
                        <input type="number" id="loseProb" min="0" max="100" step="0.1" readonly>
                    </div>
                </div>
                
                <button id="saveProbabilities" class="btn-primary">ç¢ºç‡è¨­å®šã‚’ä¿å­˜</button>
                <button id="resetProbabilities" class="btn-warning">ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã™</button>
            </div>
            
            <!-- çµ±è¨ˆæƒ…å ±ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="section">
                <h2>ğŸ“Š çµ±è¨ˆæƒ…å ±</h2>
                
                <div class="tab-container">
                    <div class="tab-buttons">
                        <button class="tab-button active" data-tab="summary">ã‚µãƒãƒªãƒ¼</button>
                        <button class="tab-button" data-tab="details">è©³ç´°ãƒ‡ãƒ¼ã‚¿</button>
                    </div>
                    
                    <div class="tab-content active" id="summary">
                        <table>
                            <tr>
                                <th>é …ç›®</th>
                                <th>å€¤</th>
                            </tr>
                            <tr>
                                <td>ç·ãƒ—ãƒ¬ã‚¤å›æ•°</td>
                                <td id="totalPlays">0</td>
                            </tr>
                            <tr>
                                <td>ã‚¸ãƒ£ãƒƒã‚¯ãƒãƒƒãƒˆå›æ•°</td>
                                <td id="jackpotWins">0</td>
                            </tr>
                            <tr>
                                <td>ãƒ“ãƒƒã‚°ã‚¦ã‚£ãƒ³å›æ•°</td>
                                <td id="bigWins">0</td>
                            </tr>
                            <tr>
                                <td>ã‚¹ãƒ¢ãƒ¼ãƒ«ã‚¦ã‚£ãƒ³å›æ•°</td>
                                <td id="smallWins">0</td>
                            </tr>
                            <tr>
                                <td>å‹ç‡</td>
                                <td id="winRate">0%</td>
                            </tr>
                        </table>
                    </div>
                    
                    <div class="tab-content" id="details">
                        <p>è©³ç´°ãƒ‡ãƒ¼ã‚¿ã¯ã¾ã å®Ÿè£…ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚</p>
                    </div>
                </div>
                
                <button id="resetStats" class="btn-danger">çµ±è¨ˆã‚’ãƒªã‚»ãƒƒãƒˆ</button>
            </div>
            
            <!-- ã‚³ãƒ¼ãƒ‰å±¥æ­´ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="section">
                <h2>ğŸŸï¸ ã‚³ãƒ¼ãƒ‰å±¥æ­´</h2>
                
                <div class="code-list">
                    <table id="codeTable">
                        <thead>
                            <tr>
                                <th>ã‚³ãƒ¼ãƒ‰</th>
                                <th>ã‚¿ã‚¤ãƒ—</th>
                                <th>æ—¥æ™‚</th>
                            </tr>
                        </thead>
                        <tbody id="codeTableBody">
                            <!-- ã‚³ãƒ¼ãƒ‰ãƒ‡ãƒ¼ã‚¿ãŒã“ã“ã«å…¥ã‚Šã¾ã™ -->
                        </tbody>
                    </table>
                </div>
                
                <div class="action-buttons">
                    <button id="exportCodes" class="btn-success">CSVã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ</button>
                    <button id="clearCodes" class="btn-danger">å±¥æ­´ã‚¯ãƒªã‚¢</button>
                </div>
            </div>
            
            <!-- ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="section">
                <h2>ğŸ® ã‚²ãƒ¼ãƒ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h2>
                
                <button id="openGame" class="btn-primary">ã‚²ãƒ¼ãƒ ã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã</button>
            </div>
        </div>
        
        <div class="footer">
            <p>MEGA SLOT ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ  v1.0</p>
        </div>
    </div>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ç¢ºç‡è¨­å®šã®åˆæœŸåŒ–
            function initProbabilities() {
                if (typeof gameManager !== 'undefined' && gameManager.config) {
                    document.getElementById('jackpotProb').value = (gameManager.config.probabilities.jackpot * 100).toFixed(1);
                    document.getElementById('bigWinProb').value = (gameManager.config.probabilities.bigWin * 100).toFixed(1);
                    document.getElementById('smallWinProb').value = (gameManager.config.probabilities.smallWin * 100).toFixed(1);
                    document.getElementById('loseProb').value = (gameManager.config.probabilities.lose * 100).toFixed(1);
                } else {
                    console.error('gameManager ã¾ãŸã¯ config ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                    showAlert('gameManagerã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚ãƒšãƒ¼ã‚¸ã‚’å†èª­ã¿è¾¼ã¿ã—ã¦ãã ã•ã„ã€‚', 'danger');
                }
            }
            
            // çµ±è¨ˆæƒ…å ±ã®åˆæœŸåŒ–
            function initStatistics() {
                if (typeof gameManager !== 'undefined' && gameManager.statistics) {
                    document.getElementById('totalPlays').textContent = gameManager.statistics.totalPlays;
                    document.getElementById('jackpotWins').textContent = gameManager.statistics.wins.jackpot;
                    document.getElementById('bigWins').textContent = gameManager.statistics.wins.bigWin;
                    document.getElementById('smallWins').textContent = gameManager.statistics.wins.smallWin;
                    
                    const totalWins = gameManager.statistics.wins.jackpot + 
                                     gameManager.statistics.wins.bigWin + 
                                     gameManager.statistics.wins.smallWin;
                    
                    const winRate = gameManager.statistics.totalPlays > 0 
                        ? ((totalWins / gameManager.statistics.totalPlays) * 100).toFixed(1) 
                        : '0.0';
                    
                    document.getElementById('winRate').textContent = winRate + '%';
                }
            }
            
            // ã‚³ãƒ¼ãƒ‰å±¥æ­´ã®åˆæœŸåŒ–
            function initCodeHistory() {
                if (typeof gameManager !== 'undefined' && gameManager.statistics && gameManager.statistics.codesGenerated) {
                    const tableBody = document.getElementById('codeTableBody');
                    tableBody.innerHTML = '';
                    
                    const codes = gameManager.statistics.codesGenerated;
                    
                    if (codes.length === 0) {
                        const row = document.createElement('tr');
                        row.innerHTML = '<td colspan="3">å±¥æ­´ã¯ã‚ã‚Šã¾ã›ã‚“</td>';
                        tableBody.appendChild(row);
                        return;
                    }
                    
                    codes.forEach(code => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${code.code}</td>
                            <td>${code.type}</td>
                            <td>${code.timestamp}</td>
                        `;
                        tableBody.appendChild(row);
                    });
                }
            }
            
            // ã‚¢ãƒ©ãƒ¼ãƒˆã®è¡¨ç¤º
            function showAlert(message, type) {
                const alertDiv = document.getElementById('probabilityAlert');
                alertDiv.className = `alert alert-${type}`;
                alertDiv.textContent = message;
                
                // 3ç§’å¾Œã«æ¶ˆãˆã‚‹
                setTimeout(() => {
                    alertDiv.textContent = '';
                    alertDiv.className = '';
                }, 3000);
            }
            
            // ç¢ºç‡ã®åˆè¨ˆãŒ100%ã«ãªã‚‹ã‚ˆã†ã«èª¿æ•´
            function updateLoseProbability() {
                const jackpot = parseFloat(document.getElementById('jackpotProb').value) || 0;
                const bigWin = parseFloat(document.getElementById('bigWinProb').value) || 0;
                const smallWin = parseFloat(document.getElementById('smallWinProb').value) || 0;
                
                let lose = 100 - (jackpot + bigWin + smallWin);
                lose = Math.max(0, lose); // è² ã®å€¤ã«ãªã‚‰ãªã„ã‚ˆã†ã«
                
                document.getElementById('loseProb').value = lose.toFixed(1);
                
                return jackpot + bigWin + smallWin <= 100;
            }
            
            // ç¢ºç‡è¨­å®šã®ä¿å­˜
            document.getElementById('saveProbabilities').addEventListener('click', function() {
                if (!updateLoseProbability()) {
                    showAlert('å‹ç‡ã®åˆè¨ˆãŒ100%ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚èª¿æ•´ã—ã¦ãã ã•ã„ã€‚', 'danger');
                    return;
                }
                
                const jackpot = parseFloat(document.getElementById('jackpotProb').value) / 100;
                const bigWin = parseFloat(document.getElementById('bigWinProb').value) / 100;
                const smallWin = parseFloat(document.getElementById('smallWinProb').value) / 100;
                const lose = parseFloat(document.getElementById('loseProb').value) / 100;
                
                if (typeof gameManager !== 'undefined') {
                    gameManager.config.probabilities = {
                        jackpot,
                        bigWin,
                        smallWin,
                        lose
                    };
                    
                    gameManager.saveConfig();
                    showAlert('ç¢ºç‡è¨­å®šã‚’ä¿å­˜ã—ã¾ã—ãŸ', 'success');
                } else {
                    showAlert('gameManagerãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'danger');
                }
            });
            
            // ç¢ºç‡è¨­å®šã®ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('resetProbabilities').addEventListener('click', function() {
                if (typeof gameManager !== 'undefined') {
                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã«æˆ»ã™
                    gameManager.config.probabilities = {
                        jackpot: 0.01,
                        bigWin: 0.05,
                        smallWin: 0.15,
                        lose: 0.79
                    };
                    
                    gameManager.saveConfig();
                    initProbabilities();
                    showAlert('ç¢ºç‡è¨­å®šã‚’ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã«æˆ»ã—ã¾ã—ãŸ', 'success');
                } else {
                    showAlert('gameManagerãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'danger');
                }
            });

            // çµ±è¨ˆã®ãƒªã‚»ãƒƒãƒˆ
            document.getElementById('resetStats').addEventListener('click', function() {
                if (typeof gameManager !== 'undefined') {
                    gameManager.statistics = {
                        totalSpins: 0,
                        wins: {
                            jackpot: 0,
                            bigWin: 0,
                            smallWin: 0
                        },
                        codesGenerated: []
                    };
                    gameManager.saveStatistics();
                    initStatistics();
                    initCodeHistory();
                    showAlert('çµ±è¨ˆæƒ…å ±ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã—ãŸ', 'success');
                } else {
                    showAlert('gameManagerãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'danger');
                }
            });

            // ã‚³ãƒ¼ãƒ‰å±¥æ­´ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
            document.getElementById('exportCodes').addEventListener('click', function() {
                if (typeof gameManager !== 'undefined' && gameManager.statistics && gameManager.statistics.codesGenerated) {
                    const codes = gameManager.statistics.codesGenerated;
                    if (codes.length === 0) {
                        showAlert('ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã™ã‚‹ã‚³ãƒ¼ãƒ‰ãŒã‚ã‚Šã¾ã›ã‚“', 'warning');
                        return;
                    }

                    let csvContent = "data:text/csv;charset=utf-8,";
                    csvContent += "ã‚³ãƒ¼ãƒ‰,ã‚¿ã‚¤ãƒ—,æ—¥æ™‚\n";
                    codes.forEach(code => {
                        csvContent += `${code.code},${code.type},${code.timestamp}\n`;
                    });

                    const encodedUri = encodeURI(csvContent);
                    const link = document.createElement('a');
                    link.setAttribute('href', encodedUri);
                    link.setAttribute('download', 'slot_codes.csv');
                    document.body.appendChild(link);
                    link.click();
                    document.body.removeChild(link);
                    showAlert('ã‚³ãƒ¼ãƒ‰å±¥æ­´ã‚’CSVã§ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã—ã¾ã—ãŸ', 'success');
                } else {
                    showAlert('gameManagerãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'danger');
                }
            });

            // ã‚³ãƒ¼ãƒ‰å±¥æ­´ã®ã‚¯ãƒªã‚¢
            document.getElementById('clearCodes').addEventListener('click', function() {
                if (typeof gameManager !== 'undefined') {
                    gameManager.statistics.codesGenerated = [];
                    gameManager.saveStatistics();
                    initCodeHistory();
                    showAlert('ã‚³ãƒ¼ãƒ‰å±¥æ­´ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success');
                } else {
                    showAlert('gameManagerãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“', 'danger');
                }
            });

            // ã‚²ãƒ¼ãƒ ã‚’æ–°ã—ã„ã‚¿ãƒ–ã§é–‹ã
            document.getElementById('openGame').addEventListener('click', function() {
                const gameUrl = window.location.origin + window.basePath + 'index.html';
                window.open(gameUrl, '_blank');
            });

            // ã‚¿ãƒ–åˆ‡ã‚Šæ›¿ãˆæ©Ÿèƒ½
            document.querySelectorAll('.tab-button').forEach(button => {
                button.addEventListener('click', function() {
                    document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                    this.classList.add('active');

                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    document.getElementById(this.dataset.tab).classList.add('active');
                });
            });

            // ç¢ºç‡å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å¤‰æ›´ã‚’ç›£è¦–ã—ã¦è² ã‘ç¢ºç‡ã‚’æ›´æ–°
            document.getElementById('jackpotProb').addEventListener('input', updateLoseProbability);
            document.getElementById('bigWinProb').addEventListener('input', updateLoseProbability);
            document.getElementById('smallWinProb').addEventListener('input', updateLoseProbability);

            // gameManagerãŒãƒ­ãƒ¼ãƒ‰ã•ã‚ŒãŸå¾Œã«åˆæœŸåŒ–å‡¦ç†ã‚’å®Ÿè¡Œ
            const checkGameManagerInterval = setInterval(() => {
                if (typeof gameManager !== 'undefined' && gameManager.config) {
                    clearInterval(checkGameManagerInterval);
                    initProbabilities();
                    initStatistics();
                    initCodeHistory();
                    console.log("ç®¡ç†ç”»é¢åˆæœŸåŒ–å®Œäº†");
                }
            }, 100);
        });
    </script>
</body>
</html>
